<!-- Loading / Not found -->
<mat-card *ngIf="(device$ | async) === undefined">Loading device…</mat-card>
<mat-card *ngIf="(device$ | async) === null" class="error">
  Device not found.
  <div class="mt-2">
    <button mat-stroked-button (click)="back()">
      <mat-icon>arrow_back</mat-icon> Back
    </button>
  </div>
</mat-card>

<!-- OK -->
<ng-container *ngIf="(device$ | async) as d">
  <!-- Page header -->
  <div class="dd-header">
    <h1 class="dd-title">Device {{ d.imei }}</h1>

    <div class="dd-actions">
      <button mat-raised-button color="primary" (click)="linkToVehicle(d)">
        <mat-icon>add</mat-icon>
        Link to Vehicle
      </button>
    </div>
  </div>

  <div class="dd-grid">
    <!-- MAIN COLUMN -->
    <div class="dd-main">
      <!-- Technical Card -->
      <mat-card class="dd-card">
        <div class="dd-card-title">Technical Card</div>

        <div class="dd-tech">
          <div class="kv">
            <div class="k">Status:</div>
            <div class="v">{{ d.online ? 'Online' : 'Offline' }}</div>
          </div>

          <div class="kv">
            <div class="k">Last Signal:</div>
            <div class="v">—</div> <!-- placeholder -->
          </div>

          <div class="kv">
            <div class="k">Firmware:</div>
            <div class="v">{{ d.firmware || '—' }}</div>
          </div>

          <div class="kv">
            <div class="k">Linked Vehicle:</div>
            <div class="v">{{ d.vehiclePlate || '—' }}</div>
          </div>
        </div>
      </mat-card>

      <!-- Recent Telemetry (empty for now) -->
      <mat-card class="dd-card">
        <div class="dd-card-title">Recent Telemetry</div>
        <div class="empty">No telemetry yet.</div>
      </mat-card>
    </div>

    <!-- RIGHT SIDEBAR -->
    <aside class="dd-aside">
      <mat-card class="dd-card">
        <div class="dd-card-title">Actions</div>
        <div class="dd-actions-col">
          <button mat-stroked-button (click)="testPing(d)">Test Ping</button>
          <button mat-raised-button color="warn" (click)="unlink(d)">Unlink</button>
        </div>
      </mat-card>
    </aside>
  </div>

  <!-- Footer actions -->
  <div class="dd-footer">
    <button mat-stroked-button (click)="back()">
      <mat-icon>arrow_back</mat-icon> Back
    </button>
  </div>
</ng-container>
