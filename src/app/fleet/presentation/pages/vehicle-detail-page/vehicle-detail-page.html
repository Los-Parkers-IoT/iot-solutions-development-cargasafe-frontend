<!-- Loading / Not found -->
<mat-card *ngIf="(vehicle$ | async) === undefined">Loading vehicle…</mat-card>
<mat-card *ngIf="(vehicle$ | async) === null" class="error">
  Vehicle not found.
  <div class="mt-2">
    <button mat-stroked-button (click)="back()">
      <mat-icon>arrow_back</mat-icon> Back
    </button>
  </div>
</mat-card>

<!-- OK -->
<ng-container *ngIf="(vehicle$ | async) as v">
  <!-- Page header -->
  <div class="vd-header">
    <h1 class="vd-title">Vehicles {{ v.plate }}</h1>

    <div class="vd-actions">
      <button mat-raised-button color="primary" (click)="setAvailable(v)">
        Set Available
      </button>
      <button mat-raised-button color="warn" (click)="setOutOfService(v)">
        Set out of Service
      </button>
    </div>
  </div>

  <div class="vd-grid">
    <!-- MAIN COLUMN -->
    <div class="vd-main">
      <!-- Technical Card -->
      <mat-card class="vd-card">
        <div class="vd-card-title">Technical Card</div>

        <div class="vd-tech">
          <div class="kv">
            <div class="k">Type:</div>
            <div class="v">{{ v.type }}</div>
          </div>

          <div class="kv">
            <div class="k">Status:</div>
            <div class="v">{{ v.status }}</div>
          </div>

          <div class="kv">
            <div class="k">IoT Device:</div>
            <div class="v">
              {{ v.deviceImei ?? '—' }}
              <span class="hint">Synced</span>
            </div>
          </div>

          <div class="kv">
            <div class="k">Capabilities:</div>
            <div class="v">
              <ng-container *ngIf="(v.capabilities?.length ?? 0) > 0; else noCaps">
                <mat-chip-set>
                  <mat-chip *ngFor="let c of v.capabilities; trackBy: trackByValue" appearance="outlined" selected>
                    {{ c }}
                  </mat-chip>
                </mat-chip-set>
              </ng-container>
              <ng-template #noCaps>—</ng-template>
            </div>
          </div>

          <div class="kv">
            <div class="k">Odometer:</div>
            <div class="v">{{ v.odometerKm ?? 0 | number }} km</div>
          </div>
        </div>
      </mat-card>

      <!-- History -->
      <mat-card class="vd-card">
        <div class="vd-card-title">History</div>
        <div class="empty">No history yet.</div>
      </mat-card>
    </div>

    <!-- RIGHT SIDEBAR -->
    <aside class="vd-aside">
      <mat-card class="vd-card">
        <div class="vd-card-title">Current Assignment</div>
        <div class="empty">None</div>
      </mat-card>
    </aside>
  </div>

  <!-- Footer actions -->
  <div class="vd-footer">
    <button mat-stroked-button (click)="back()">
      <mat-icon>arrow_back</mat-icon> Back
    </button>
  </div>
</ng-container>
